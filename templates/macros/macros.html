{% macro pagination(pager) %}
    {% if pager %}
        <nav class="pagination">
            <ul>
                <!-- Previous page link -->
                {% if paginator.previous %}
                    <li><a href="{{ paginator.previous }}" rel="prev">← Previous</a></li>
                {% else %}
                    <li><span class="disabled">← Previous</a></li>
                {% endif %}

                {% set current_page = pager.current_index %}
                {% set total_pages = pager.number_pagers %}
                {% set max_display = 5 %}
                
                {% set start_page = (current_page - max_display / 2) | round(method="floor") | int %}
                {% if start_page < 1 %}
                    {% set start_page = 1 %}
                {% endif %}

                {% set end_page = start_page + max_display - 1 %}
                {% if end_page > total_pages %}
                    {% set end_page = total_pages %}
                    {% set start_page = (total_pages - max_display + 1) %}
                    {% if start_page < 1 %}
                        {% set start_page = 1 %}
                    {% endif %}
                {% endif %}

                <!-- Page numbers -->
                {% for i in range(start=start_page, end=end_page + 1) %}
                    {% set page_url = paginator.base_url %}
                    {% if i == 1 %}
                        {% set page_url = paginator.first %}
                    {% else %}
                        {% set page_url = paginator.base_url ~ i ~ "/" %}
                    {% endif %}
                    <li>
                        {% if i == current_page %}
                            <span class="current">{{ i }}</span>
                        {% else %}
                            <a href="{{ page_url }}">{{ i }}</a>
                        {% endif %}
                    </li>
                {% endfor %}
                
                <!-- Next page link -->
                {% if paginator.next %}
                    <li><a href="{{ paginator.next }}" rel="next">Next →</a></li>
                {% else %}
                    <li><span class="disabled">Next →</span></li>
                {% endif %}
           </ul>
        </nav>  
    {% endif %}
{% endmacro %}

{% macro post_meta(post) %}
    {% if post and post.date and post.authors %}
        <div class="post-meta">
            <span class="author">By {{ post.authors | join(sep=", ") }}</span>
            <span class="date">{{ post.date | date(format="%B %d, %Y", timezone="America/New_York") }}</span>
            {% if post.taxonomies.tags %}

            <div class="post-tags">
                {% for tag in post.taxonomies.tags %}
                    <span class="tag"><a href="{{ get_taxonomy_url(kind="tags", name=tag) }}">{{ tag }}</a></span>
                {% endfor %}
            </div>
            {% endif %}            
        </div>
    {% endif %}
{% endmacro %}

{% macro post_excerpt(post) %}
    {% if post %}
        <p class="post-excerpt">
            {% if post.summary %}
                {{ post.summary | striptags | trim | safe }}
            {% else %}
                {{ post.content | striptags | trim | truncate(length=172) | safe }}
            {% endif %}
        </p>
    {% endif %}
{% endmacro %}

{% macro blog_post(post) %}
    {% if post %}
        <article class="blog-post">
            <h2>{{ post.title }}</h2>
            {{ macros::post_meta(post=post) }}
            {{ macros::post_excerpt(post=post) }}
            <a href="{{ post.permalink }}" class="read-more">Read More</a>
        </article>
    {% endif %}
{% endmacro %}


